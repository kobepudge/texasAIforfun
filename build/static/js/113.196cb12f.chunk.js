"use strict";(self.webpackChunkpoker_ai_demo=self.webpackChunkpoker_ai_demo||[]).push([[113],{113:(e,t,n)=>{n.d(t,{FastDecisionEngine:()=>r});class o{generatePrompt(e,t,n,o,i,a){switch(o){case"minimal":return this.generateMinimalPrompt(e,t,n,i);case"standard":default:return this.generateStandardPrompt(e,t,n,i);case"detailed":return this.generateDetailedPrompt(e,t,n,i,a);case"comprehensive":return this.generateComprehensivePrompt(e,t,n,i,a)}}generateMinimalPrompt(e,t,n,o){const i=e.players.find(e=>e.id===t);return`FAST_POKER_DECISION\nHand: ${`${n[0].rank}${n[0].suit}${n[1].rank}${n[1].suit}`}\nPot: ${e.pot}\nToCall: ${this.getAmountToCall(e,t)}\nStack: ${(null===i||void 0===i?void 0:i.chips)||0}\nPhase: ${e.phase}\nBoard: ${this.getBoardString(e.communityCards)}\n\nRESPOND_JSON_ONLY:\n{"action": "fold/call/raise", "amount": number, "confidence": 0.8}`}generateStandardPrompt(e,t,n,o){const i=e.players.find(e=>e.id===t),a=`${n[0].rank}${n[0].suit}${n[1].rank}${n[1].suit}`,r=this.getPlayerPosition(e,t),s=this.getActiveOpponents(e,t);return`PokerGPT-Pro\u6807\u51c6\u5206\u6790 | \u65f6\u9650: ${o}ms\n\n\ud83c\udccf \u624b\u724c: ${a}\n\ud83d\udccd \u4f4d\u7f6e: ${r}\n\ud83d\udcb0 \u7b79\u7801: ${(null===i||void 0===i?void 0:i.chips)||0}\n\ud83c\udfaf \u5e95\u6c60: ${e.pot}\n\ud83d\udccb \u9636\u6bb5: ${e.phase}\n\ud83c\udfb2 \u724c\u9762: ${this.getBoardString(e.communityCards)}\n\ud83d\udc65 \u5bf9\u624b: ${s.length}\u4eba\n\n\u5feb\u901f\u5206\u6790\u8981\u6c42:\n1. \u624b\u724c\u5f3a\u5ea6 (1-10)\n2. \u4f4d\u7f6e\u4f18\u52bf\u8bc4\u4f30\n3. \u5e95\u6c60\u8d54\u7387\u8ba1\u7b97\n4. \u57fa\u7840GTO\u7b56\u7565\n\nJSON\u683c\u5f0f\u56de\u590d:\n{\n  "action": "fold/call/raise",\n  "amount": number,\n  "confidence": 0.8,\n  "reasoning": "\u7b80\u6d01\u7406\u7531(15\u5b57\u5185)",\n  "hand_strength": 7,\n  "position_factor": "early/middle/late"\n}`}generateDetailedPrompt(e,t,n,o,i){const a=e.players.find(e=>e.id===t),r=`${n[0].rank}${n[0].suit}${n[1].rank}${n[1].suit}`,s=this.getActionHistory(e),c=this.calculatePotOdds(e,t);this.getStackSizes(e);return`PokerGPT-Pro\u6df1\u5ea6\u5206\u6790 | \u65f6\u9650: ${o}ms | \u6e29\u5ea6: ${i}\n\n\ud83c\udfae \u6e38\u620f\u72b6\u6001:\n- \u624b\u724c: ${r}\n- \u4f4d\u7f6e: ${this.getPlayerPosition(e,t)}\n- \u7b79\u7801: ${(null===a||void 0===a?void 0:a.chips)||0} (${Math.round(((null===a||void 0===a?void 0:a.chips)||0)/e.bigBlind)}BB)\n- \u5e95\u6c60: ${e.pot} (${Math.round(e.pot/e.bigBlind)}BB)\n- \u9636\u6bb5: ${e.phase}\n- \u724c\u9762: ${this.getBoardString(e.communityCards)}\n\n\ud83d\udcca \u5173\u952e\u6570\u636e:\n- \u5e95\u6c60\u8d54\u7387: ${c}\n- \u8ddf\u6ce8\u91d1\u989d: ${this.getAmountToCall(e,t)}\n- SPR: ${this.calculateSPR(e,t)}\n- \u5bf9\u624b\u6570\u91cf: ${this.getActiveOpponents(e,t).length}\n\n\ud83d\udcc8 \u884c\u52a8\u5386\u53f2:\n${s.slice(-5).map(e=>`${e.player}: ${e.action} ${e.amount||""}`).join("\n")}\n\n\ud83c\udfaf \u5206\u6790\u8981\u6c42:\n1. \u624b\u724c\u5f3a\u5ea6\u8bc4\u4f30 (\u8003\u8651\u724c\u9762\u7ed3\u6784)\n2. \u4f4d\u7f6e\u4f18\u52bf\u5206\u6790\n3. \u5bf9\u624b\u8303\u56f4\u4f30\u8ba1\n4. \u5e95\u6c60\u8d54\u7387 vs \u80dc\u7387\u8ba1\u7b97\n5. \u9690\u542b\u8d54\u7387\u8003\u8651\n6. GTO\u57fa\u7840 + \u5bf9\u624b\u8c03\u6574\n\nJSON\u683c\u5f0f\u56de\u590d:\n{\n  "action": "fold/call/raise",\n  "amount": number,\n  "confidence": 0.8,\n  "reasoning": "\u8be6\u7ec6\u63a8\u7406(30\u5b57\u5185)",\n  "hand_strength": 7,\n  "position_factor": "early/middle/late",\n  "opponent_adjustment": "tighter/standard/looser",\n  "pot_odds_analysis": "favorable/marginal/unfavorable"\n}`}generateComprehensivePrompt(e,t,n,o,i){const a=e.players.find(e=>e.id===t),r=`${n[0].rank}${n[0].suit}${n[1].rank}${n[1].suit}`,s=this.analyzeBoardTexture(e.communityCards),c=this.getOpponentProfiles(e,t),l=this.analyzeGameFlow(e);return`PokerGPT-Pro\u4e13\u5bb6\u7ea7\u5206\u6790 | \u65f6\u9650: ${o}ms | \u6e29\u5ea6: ${i}\n\n\ud83c\udfae \u5b8c\u6574\u6e38\u620f\u72b6\u6001:\n- \u624b\u724c: ${r}\n- \u4f4d\u7f6e: ${this.getPlayerPosition(e,t)} (${this.getPositionDetails(e,t)})\n- \u7b79\u7801: ${(null===a||void 0===a?void 0:a.chips)||0} (${Math.round(((null===a||void 0===a?void 0:a.chips)||0)/e.bigBlind)}BB)\n- \u5e95\u6c60: ${e.pot} (${Math.round(e.pot/e.bigBlind)}BB)\n- \u9636\u6bb5: ${e.phase}\n- \u724c\u9762: ${this.getBoardString(e.communityCards)}\n\n\ud83c\udfb2 \u724c\u9762\u5206\u6790:\n- \u7ed3\u6784: ${s.texture}\n- \u542c\u724c: ${s.draws}\n- \u5371\u9669\u5ea6: ${s.danger}\n\n\ud83d\udc65 \u5bf9\u624b\u6863\u6848:\n${c.map(e=>`${e.name}: ${e.style} (VPIP: ${e.vpip}%, PFR: ${e.pfr}%)`).join("\n")}\n\n\ud83d\udcca \u9ad8\u7ea7\u6570\u636e:\n- \u5e95\u6c60\u8d54\u7387: ${this.calculatePotOdds(e,t)}\n- SPR: ${this.calculateSPR(e,t)}\n- \u9690\u542b\u8d54\u7387: ${this.calculateImpliedOdds(e,t)}\n- \u53cd\u5411\u9690\u542b\u8d54\u7387: ${this.calculateReverseImpliedOdds(e,t)}\n\n\ud83d\udcc8 \u6e38\u620f\u6d41\u7a0b:\n- \u7ffb\u524d\u884c\u52a8: ${l.preflop}\n- \u7ffb\u540e\u8d8b\u52bf: ${l.postflop}\n- \u6fc0\u8fdb\u5ea6: ${l.aggression}\n\n\ud83c\udfaf \u4e13\u5bb6\u7ea7\u5206\u6790\u8981\u6c42:\n1. \u7cbe\u786e\u624b\u724c\u5f3a\u5ea6\u8bc4\u4f30 (\u8003\u8651\u6240\u6709\u56e0\u7d20)\n2. \u5bf9\u624b\u8303\u56f4\u6784\u5efa\u4e0e\u66f4\u65b0\n3. \u591a\u5c42\u6b21EV\u8ba1\u7b97 (\u76f4\u63a5+\u9690\u542b+\u53cd\u5411\u9690\u542b)\n4. \u5fc3\u7406\u535a\u5f08\u5c42\u6b21\u5206\u6790\n5. \u5e73\u8861\u7b56\u7565\u8003\u8651\n6. Meta-game\u8c03\u6574\n7. \u98ce\u9669\u7ba1\u7406\u8bc4\u4f30\n\nJSON\u683c\u5f0f\u56de\u590d:\n{\n  "action": "fold/call/raise",\n  "amount": number,\n  "confidence": 0.8,\n  "reasoning": "\u6df1\u5ea6\u63a8\u7406(50\u5b57\u5185)",\n  "hand_strength": 7,\n  "position_factor": "early/middle/late",\n  "opponent_adjustment": "tighter/standard/looser",\n  "play_type": "value/bluff/protection/pot_control",\n  "ev_analysis": {\n    "fold_ev": number,\n    "call_ev": number,\n    "raise_ev": number\n  },\n  "risk_assessment": "low/medium/high",\n  "meta_considerations": "string"\n}`}getBoardString(e){return e&&e.length?e.map(e=>`${e.rank}${e.suit}`).join(" "):"\u65e0"}getPlayerPosition(e,t){return"middle"}getActiveOpponents(e,t){return e.players.filter(e=>e.isActive&&e.id!==t)}getAmountToCall(e,t){return 0}calculatePotOdds(e,t){return"2:1"}calculateSPR(e,t){return 5}getActionHistory(e){return[]}getStackSizes(e){return"\u6df1\u7b79\u7801"}analyzeBoardTexture(e){return{texture:"\u5e72\u71e5",draws:"\u65e0",danger:"\u4f4e"}}getOpponentProfiles(e,t){return[]}analyzeGameFlow(e){return{preflop:"\u6807\u51c6",postflop:"\u88ab\u52a8",aggression:"\u4e2d\u7b49"}}getPositionDetails(e,t){return"CO\u4f4d"}calculateImpliedOdds(e,t){return"\u826f\u597d"}calculateReverseImpliedOdds(e,t){return"\u4e2d\u7b49"}}class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;this.connections=[],this.currentConnectionIndex=0,this.requestQueue=[],this.isProcessingQueue=!1,this.initializeConnections(e,t),this.startQueueProcessor(),console.log(`\ud83d\ude80 AI API\u8fde\u63a5\u6c60\u521d\u59cb\u5316\u5b8c\u6210 (${t}\u4e2a\u8fde\u63a5)`)}initializeConnections(e,t){for(let n=0;n<t;n++){const t={id:`conn_${n}`,config:{...e},isActive:!0,requestCount:0,errorCount:0,averageResponseTime:0,lastUsed:0};this.connections.push(t)}}async makeDecisionRequest(e,t){var n;return this.makeDecisionRequestWithConfig(e,t,(null===(n=this.connections[0])||void 0===n?void 0:n.config.temperature)||.1)}async makeDecisionRequestWithConfig(e,t,n){const o=Date.now();try{const i=this.selectBestConnection(),a=await this.makeAPIRequestWithConfig(i,e,t,n),r=this.parseAIResponse(a);return this.updateConnectionStats(i,Date.now()-o,!0),r}catch(i){return console.error("\u274c AI API\u8bf7\u6c42\u5931\u8d25:",i),await this.tryBackupRequestWithConfig(e,t,n,o)}}async makeParallelRequest(e,t){if(0===this.connections.filter(e=>e.isActive).length)throw new Error("\u6ca1\u6709\u53ef\u7528\u7684API\u8fde\u63a5");return console.log("\ud83c\udfaf \u4f7f\u7528\u5355\u4e00\u8bf7\u6c42\u66ff\u4ee3\u5e76\u884c\u8bf7\u6c42\uff08\u66f4\u7a33\u5b9a\uff09"),this.makeDecisionRequest(e,t)}selectBestConnection(){const e=this.connections.filter(e=>e.isActive);if(0===e.length)throw new Error("\u6ca1\u6709\u53ef\u7528\u7684API\u8fde\u63a5");return e.reduce((e,t)=>{const n=this.calculateConnectionScore(e);return this.calculateConnectionScore(t)>n?t:e})}calculateConnectionScore(e){return.5*(e.requestCount>0?(e.requestCount-e.errorCount)/e.requestCount:1)+.3*(e.averageResponseTime>0?Math.max(0,1-e.averageResponseTime/1e4):1)+.2*(Date.now()-e.lastUsed>5e3?1:.5)}async makeAPIRequest(e,t,n){return this.makeAPIRequestWithConfig(e,t,n,e.config.temperature)}async makeAPIRequestWithConfig(e,t,n,o){const i=new AbortController,a=setTimeout(()=>i.abort(),n);try{const n=await fetch(`${e.config.baseUrl}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.config.apiKey}`},body:JSON.stringify({model:e.config.model,messages:[{role:"system",content:"\u4f60\u662f\u4e16\u754c\u9876\u7ea7\u7684\u5fb7\u5dde\u6251\u514bAI\uff0c\u4e13\u6ce8\u4e8e\u5feb\u901f\u3001\u51c6\u786e\u7684\u51b3\u7b56\u3002"},{role:"user",content:t}],temperature:o,max_tokens:e.config.maxTokens,stream:!1}),signal:i.signal});if(clearTimeout(a),!n.ok)throw new Error(`API\u8bf7\u6c42\u5931\u8d25: ${n.status} ${n.statusText}`);const r=await n.json();if(!r.choices||!r.choices[0]||!r.choices[0].message)throw new Error("API\u54cd\u5e94\u683c\u5f0f\u9519\u8bef");return r.choices[0].message.content}catch(r){if(clearTimeout(a),"AbortError"===r.name)throw new Error(`API\u8bf7\u6c42\u8d85\u65f6 (${n}ms)`);throw r}}parseAIResponse(e){try{const t=e.match(/\{[\s\S]*\}/);if(!t)throw new Error("\u54cd\u5e94\u4e2d\u672a\u627e\u5230JSON\u683c\u5f0f");const n=t[0],o=JSON.parse(n);if(!o.action||!["fold","check","call","bet","raise","all-in"].includes(o.action))throw new Error("\u65e0\u6548\u7684\u884c\u52a8\u7c7b\u578b");const i={action:"bet"===o.action?"raise":o.action,amount:o.amount||0,confidence:o.confidence||.5,reasoning:o.reasoning||"\u65e0\u63a8\u7406\u4fe1\u606f",decisionTime:0,metadata:{handStrength:o.hand_strength||o.handStrength||.5,positionFactor:o.position_factor||o.positionFactor||"unknown",opponentAdjustment:o.opponent_adjustment||o.opponentAdjustment||"standard",playType:o.play_type||o.playType||"unknown"}};return console.log("\u2705 AI\u54cd\u5e94\u89e3\u6790\u6210\u529f:",i.action),i}catch(t){return console.error("\u274c AI\u54cd\u5e94\u89e3\u6790\u5931\u8d25:",t),console.log("\u539f\u59cb\u54cd\u5e94:",e),{action:"fold",amount:0,confidence:.3,reasoning:"\u54cd\u5e94\u89e3\u6790\u5931\u8d25\uff0c\u5b89\u5168\u5f03\u724c",decisionTime:0,metadata:{handStrength:0,positionFactor:"unknown",opponentAdjustment:"error",playType:"emergency_fold"}}}}async tryBackupRequest(e,t,n){var o;return this.tryBackupRequestWithConfig(e,t,(null===(o=this.connections[0])||void 0===o?void 0:o.config.temperature)||.1,n)}async tryBackupRequestWithConfig(e,t,n,o){const i=Math.max(1e3,t-(Date.now()-o)),a=this.connections.filter(e=>e.isActive);for(const s of a)try{console.log(`\ud83d\udd04 \u5c1d\u8bd5\u5907\u7528\u8fde\u63a5: ${s.id} (\u6e29\u5ea6: ${n})`);const t=await this.makeAPIRequestWithConfig(s,e,i,n),a=this.parseAIResponse(t);return this.updateConnectionStats(s,Date.now()-o,!0),a}catch(r){console.log(`\u274c \u5907\u7528\u8fde\u63a5\u5931\u8d25: ${s.id}`),this.updateConnectionStats(s,Date.now()-o,!1)}return console.error("\u274c \u6240\u6709API\u8fde\u63a5\u90fd\u5931\u8d25\u4e86"),this.getEmergencyDecision()}getEmergencyDecision(){return{action:"fold",amount:0,confidence:.1,reasoning:"API\u8fde\u63a5\u5931\u8d25\uff0c\u7d27\u6025\u5f03\u724c",decisionTime:0,metadata:{handStrength:0,positionFactor:"unknown",opponentAdjustment:"emergency",playType:"emergency_fold"}}}updateConnectionStats(e,t,n){if(e.requestCount++,e.lastUsed=Date.now(),n)e.averageResponseTime=(e.averageResponseTime*(e.requestCount-1)+t)/e.requestCount;else{e.errorCount++;e.errorCount/e.requestCount>.5&&e.requestCount>5&&(e.isActive=!1,console.warn(`\u26a0\ufe0f \u8fde\u63a5 ${e.id} \u9519\u8bef\u7387\u8fc7\u9ad8\uff0c\u6682\u65f6\u7981\u7528`),setTimeout(()=>{e.isActive=!0,e.errorCount=0,console.log(`\ud83d\udd04 \u8fde\u63a5 ${e.id} \u91cd\u65b0\u542f\u7528`)},3e5))}}startQueueProcessor(){setInterval(()=>{!this.isProcessingQueue&&this.requestQueue.length>0&&this.processRequestQueue()},100)}async processRequestQueue(){if(0===this.requestQueue.length)return;this.isProcessingQueue=!0;const e=this.requestQueue.shift();try{const t=await this.makeDecisionRequest(e.prompt,e.timeLimit);e.resolve(t)}catch(t){e.reject(t)}this.isProcessingQueue=!1}getPoolStatus(){const e=this.connections.filter(e=>e.isActive).length,t=this.connections.reduce((e,t)=>e+t.requestCount,0),n=this.connections.reduce((e,t)=>e+t.errorCount,0),o=this.connections.reduce((e,t)=>e+t.averageResponseTime,0)/this.connections.length;return{totalConnections:this.connections.length,activeConnections:e,totalRequests:t,totalErrors:n,successRate:t>0?(t-n)/t:1,averageResponseTime:o,queueLength:this.requestQueue.length}}cleanup(){this.connections.forEach(e=>{e.isActive=!1}),this.requestQueue=[],console.log("\ud83e\uddf9 AI API\u8fde\u63a5\u6c60\u5df2\u6e05\u7406")}}class a{analyzeSituation(e,t,n){var o;console.log("\ud83d\udd0d SituationComplexityAnalyzer\u6536\u5230\u7684gameState:",{phase:e.phase,phaseType:typeof e.phase,gameStateKeys:Object.keys(e),hasPhase:"phase"in e,gameStateStructure:{gameId:e.gameId,phase:e.phase,players:null===(o=e.players)||void 0===o?void 0:o.length,pot:e.pot}});let i=0;switch(e.phase){case"preflop":i=20;break;case"flop":i=35;break;case"turn":i=50;break;case"river":i=65;break;default:i=30}const a=(e.pot||0)/(e.bigBlind||100);a>20?i+=15:a>10?i+=8:a>5&&(i+=3);const r=e.players.filter(e=>e.isActive&&e.id!==t).length;r>=3?i+=10:r>=2&&(i+=5);const s=Math.min(i,100),c={handStrengthAmbiguity:Math.floor(.3*s),opponentRangeWidth:Math.floor(.25*s),actionSequenceComplexity:Math.floor(.25*s),stackAndPotDynamics:Math.floor(.2*s)};return{totalScore:s,category:this.categorizeComplexity(s),factors:c,recommendedTimeout:this.getRecommendedTimeout(s),recommendedTemperature:this.getRecommendedTemperature(s),promptType:this.getPromptType(s)}}categorizeComplexity(e){return e<=25?"simple":e<=50?"medium":e<=75?"complex":"extreme"}getRecommendedTimeout(e){return e<=25?15e3:e<=50?25e3:e<=75?35e3:45e3}getRecommendedTemperature(e){return e<=25?.1:e<=50?.3:e<=75?.5:.7}getPromptType(e){return e<=25?"minimal":e<=50?"standard":e<=75?"detailed":"comprehensive"}}class r{constructor(e){this.decisionCache=new Map,this.apiPool=void 0,this.promptManager=void 0,this.performanceTracker=void 0,this.complexityAnalyzer=void 0,this.adaptivePromptManager=void 0;const t={apiKey:e.apiKey,baseUrl:e.baseUrl,model:e.model,temperature:.1,maxTokens:150,timeout:6e4};this.apiPool=new i(t,3),this.promptManager=new s,this.performanceTracker=new c,this.complexityAnalyzer=new a,this.adaptivePromptManager=new o,console.log("\u26a1 \u5feb\u901f\u51b3\u7b56\u5f15\u64ce\u521d\u59cb\u5316\u5b8c\u6210 (\u542b\u667a\u80fd\u590d\u6742\u5ea6\u5206\u6790)")}async makeDecision(e,t,n,o){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4;const a=Date.now();try{if("preflop"===e.phase){console.log("\u26a1 \u7ffb\u524d\u9636\u6bb5\uff0c\u4f7f\u7528GTO\u67e5\u8868\u51b3\u7b56");try{const o=await this.getGTOPreflopDecision(e,t,n);if(o){const e=Date.now()-a;return console.log(`\u26a1 GTO\u7ffb\u524d\u51b3\u7b56\u5b8c\u6210: ${o.action} (${e}ms)`),o}}catch(r){console.warn("\u26a0\ufe0f GTO\u51b3\u7b56\u5931\u8d25\uff0c\u56de\u9000\u5230AI\u51b3\u7b56:",r)}}const s=this.buildGameData(e,t,n,o,i),c=await this.executeLayeredDecision(s,e,t,n),l=Date.now()-a;return this.performanceTracker.recordDecision(t,l,c.confidence),console.log(`\u26a1 \u51b3\u7b56\u5b8c\u6210: ${c.action} (${l}ms)`),c}catch(s){return console.error("\u274c \u51b3\u7b56\u5f15\u64ce\u9519\u8bef:",s),this.getEmergencyDecision(e,n)}}buildGameData(e,t,n,o,i){const a=e.players.find(e=>e.id===t);if(!a)throw new Error("\u73a9\u5bb6\u4e0d\u5b58\u5728");const r=this.getPlayerPosition(e,t),s=e.players.findIndex(e=>e.id===t),c=[];e.players.forEach(n=>{if(n.id!==t){const t=o.get(n.id);t&&c.push({name:n.name,position:this.getPlayerPosition(e,n.id),vpip:t.vpip,pfr:t.pfr,aggression:t.aggression,tendency:t.tendency})}});const l=this.buildActionSequence(e),u=Math.max(0,e.currentBet-(a.currentBet||0)),d=u>0?`${(e.pot/u).toFixed(1)}:1`:"N/A";return{position:r,positionIndex:s,holeCards:this.formatCards(n),myChips:a.chips,pot:e.pot,currentBet:e.currentBet,toCall:u,activePlayers:e.players.filter(e=>e.isActive).length,totalPlayers:e.players.length,actionSequence:l,opponentProfiles:c,potOdds:d,timeLimit:i,phase:e.phase,..."preflop"!==e.phase&&{board:this.formatCards(e.communityCards),boardTexture:this.analyzeBoardTexture(e.communityCards),drawHeavy:this.isDrawHeavyBoard(e.communityCards),currentRoundActions:this.buildCurrentRoundActions(e),recentOpponentBehavior:this.buildOpponentBehaviorSummary(o)}}}async executeLayeredDecision(e,t,n,o){console.log("\ud83d\ude80 \u5f3a\u5236\u4f7f\u7528AI API\u51b3\u7b56 - \u8df3\u8fc7\u7f13\u5b58\u548c\u660e\u663e\u51b3\u7b56");const i=await this.performStrategicAnalysis(e,t,n,o);return this.applyFineTuning(i,e)}async tryQuickDecision(e){const t=Date.now(),n=this.checkDecisionCache(e);if(n)return console.log("\ud83c\udfaf \u7f13\u5b58\u547d\u4e2d"),n.decision;const o=this.checkObviousDecisions(e);if(o)return console.log("\ud83c\udfaf \u660e\u663e\u51b3\u7b56"),o;const i=Date.now()-t;return i>50&&console.log(`\u26a0\ufe0f \u5feb\u901f\u51b3\u7b56\u8d85\u65f6: ${i}ms`),null}async performStrategicAnalysis(e,t,n,o){const i=Date.now();try{const a=this.complexityAnalyzer.analyzeSituation(t,n,o);console.log(`\ud83c\udfaf \u5c40\u52bf\u590d\u6742\u5ea6: ${a.category} (${a.totalScore}/100)`),console.log(`\ud83d\udcca \u63a8\u8350: \u8d85\u65f6${a.recommendedTimeout}ms, \u6e29\u5ea6${a.recommendedTemperature}, Prompt${a.promptType}`);const r=5e4,s=Math.min(a.recommendedTimeout,e.timeLimit-500,r),c=this.adaptivePromptManager.generatePrompt(t,n,o,a.promptType,s,a.recommendedTemperature);console.log(`\ud83e\udde0 \u53d1\u8d77\u667a\u80fdAI\u51b3\u7b56\u8bf7\u6c42 (\u65f6\u9650: ${s}ms, \u6e29\u5ea6: ${a.recommendedTemperature})`);const l=await this.apiPool.makeDecisionRequestWithConfig(c,s,a.recommendedTemperature);console.log("\u26a1 \u667a\u80fdAI\u51b3\u7b56\u8bf7\u6c42\u6210\u529f"),l.decisionTime=Date.now()-i,l.metadata={...l.metadata,complexityScore:a.totalScore,complexityCategory:a.category,promptType:a.promptType},this.cacheDecision(e,l);const u=Date.now()-i;return console.log(`\ud83e\udde0 \u667a\u80fd\u7b56\u7565\u5206\u6790\u5b8c\u6210: ${u}ms, \u51b3\u7b56: ${l.action}, \u590d\u6742\u5ea6: ${a.category}`),l}catch(a){console.error("\u274c \u7b56\u7565\u5206\u6790\u5931\u8d25:",a);const t=this.getBasicDecision(e);return t.decisionTime=Date.now()-i,t.reasoning+=" (AI\u5931\u8d25\u56de\u9000)",t}}applyFineTuning(e,t){const n=Date.now();"raise"===e.action&&Math.random()<.1&&(e.amount=Math.floor(e.amount*(.8+.4*Math.random()))),"BTN"===t.position&&"call"===e.action&&Math.random()<.2&&(e.action="raise",e.amount=2.5*t.currentBet,e.reasoning+=" (\u6309\u94ae\u4f4d\u7f6e\u52a0\u6ce8)");t.myChips/100<20&&"call"===e.action&&(e.action="raise",e.amount=t.myChips,e.reasoning+=" (\u77ed\u7b79\u7801\u5168\u62bc)");const o=Date.now()-n;return console.log(`\ud83c\udfa8 \u7cbe\u7ec6\u8c03\u6574\u5b8c\u6210: ${o}ms`),e}checkObviousDecisions(e){return this.isNutsHand(e.holeCards,e.board)?{action:"raise",amount:.8*e.pot,confidence:.95,reasoning:"\u8d85\u5f3a\u724c\u4ef7\u503c\u4e0b\u6ce8",decisionTime:50,metadata:{handStrength:.95,positionFactor:e.position,opponentAdjustment:"value",playType:"value"}}:this.isTrashHand(e.holeCards)&&e.toCall>.5*e.pot?{action:"fold",amount:0,confidence:.9,reasoning:"\u5783\u573e\u724c\u9762\u5bf9\u5927\u6ce8",decisionTime:50,metadata:{handStrength:.1,positionFactor:e.position,opponentAdjustment:"fold",playType:"fold"}}:0===e.toCall?{action:"check",amount:0,confidence:.8,reasoning:"\u514d\u8d39\u770b\u724c",decisionTime:50,metadata:{handStrength:.5,positionFactor:e.position,opponentAdjustment:"standard",playType:"check"}}:null}checkDecisionCache(e){const t=this.generateSituationKey(e),n=this.decisionCache.get(t);return n&&Date.now()-n.timestamp<3e5?(n.hitCount++,n):null}cacheDecision(e,t){const n=this.generateSituationKey(e);if(this.decisionCache.set(n,{situationKey:n,decision:{...t},timestamp:Date.now(),hitCount:0,confidence:t.confidence}),this.decisionCache.size>1e3){const e=Array.from(this.decisionCache.keys())[0];this.decisionCache.delete(e)}}generateSituationKey(e){return`${this.calculateHandStrength(e.holeCards)}_${this.getPositionGroup(e.position)}_${this.getActionType(e.actionSequence)}_${this.getPotOddsGroup(e.potOdds)}_${e.phase}`}async getGTOPreflopDecision(e,t,o){try{const{gtoService:i}=await n.e(289).then(n.bind(n,289)),a=e.players.find(e=>e.id===t);if(!a)throw new Error("\u627e\u4e0d\u5230\u5f53\u524d\u73a9\u5bb6");const r=i.formatHoleCards(o);if("XX"===r)throw new Error("\u65e0\u6548\u624b\u724c");const s=i.formatPosition(a.position,e.players.length,e.dealerIndex),c=i.calculateStackDepth(a.chips,e.bigBlind||100),l=i.analyzeFacingAction(e,t),u={hand:r,position:s,facing_action:l,players_behind:i.calculatePlayersBehind(e,t),stack_bb:c};console.log(`\ud83d\udd0d GTO\u67e5\u8be2: ${JSON.stringify(u)}`);const d=await Promise.race([i.getPreflopDecision(u),new Promise((e,t)=>setTimeout(()=>t(new Error("GTO\u51b3\u7b56\u8d85\u65f6")),8e3))]);return{action:d.action,amount:this.calculateGTOAmount(d,e),confidence:d.frequency,reasoning:`GTO\u7ffb\u524d\u7b56\u7565: ${d.reasoning}`,decisionTime:0,metadata:{handStrength:this.getHandStrengthFromTier(d.hand_tier),positionFactor:a.position,opponentAdjustment:"gto",playType:"gto_preflop",gtoData:d}}}catch(i){return console.error("\u274c GTO\u7ffb\u524d\u51b3\u7b56\u5931\u8d25:",i),null}}calculateGTOAmount(e,t){const n=t.bigBlind||100;switch(e.action){case"fold":default:return 0;case"call":return t.currentBet;case"limp":return n;case"raise":return Math.round(e.amount*n);case"all_in":return 999999}}getHandStrengthFromTier(e){return{PREMIUM:.95,STRONG:.8,MEDIUM:.6,WEAK:.4,SPECULATIVE:.3,TRASH:.1,UNKNOWN:.5}[e]||.5}getEmergencyDecision(e,t){return{action:"fold",amount:0,confidence:.5,reasoning:"\u7cfb\u7edf\u9519\u8bef\uff0c\u5b89\u5168\u5f03\u724c",decisionTime:0,metadata:{handStrength:0,positionFactor:"unknown",opponentAdjustment:"emergency",playType:"emergency_fold"}}}getBasicDecision(e){const t=this.calculateHandStrength(e.holeCards);return t>.7?{action:"raise",amount:Math.round(Math.max(2*e.currentBet,100)),confidence:.7,reasoning:"\u5f3a\u724c\u57fa\u7840\u7b56\u7565",decisionTime:1e3,metadata:{handStrength:t,positionFactor:e.position,opponentAdjustment:"basic",playType:"value"}}:t>.4&&e.toCall<.3*e.pot?{action:"call",amount:e.toCall,confidence:.6,reasoning:"\u4e2d\u7b49\u724c\u529b\u8ddf\u6ce8",decisionTime:1e3,metadata:{handStrength:t,positionFactor:e.position,opponentAdjustment:"basic",playType:"call"}}:{action:"fold",amount:0,confidence:.8,reasoning:"\u724c\u529b\u4e0d\u8db3\u5f03\u724c",decisionTime:1e3,metadata:{handStrength:t,positionFactor:e.position,opponentAdjustment:"basic",playType:"fold"}}}getPlayerPosition(e,t){const n=e.players.findIndex(e=>e.id===t),o=e.dealerIndex,i=e.players.length,a=(n-o+i)%i,r=["BTN","SB","BB","UTG","UTG+1","UTG+2","MP","MP+1","CO"];return console.log(`\ud83d\udd0d \u4f4d\u7f6e\u8ba1\u7b97: \u73a9\u5bb6${t} playerIndex=${n}, dealerIndex=${o}, positionIndex=${a}, \u4f4d\u7f6e=${r[a]}`),r[a]||`POS${a}`}formatCards(e){return e.map(e=>`${e.rank}${e.suit}`).join(" ")}buildActionSequence(e){return e.currentRoundActions&&0!==e.currentRoundActions.length?e.currentRoundActions.map(e=>`${e.playerName}:${e.action}${e.amount?`(${e.amount})`:""}`).join(" \u2192 "):"\u6e38\u620f\u5f00\u59cb"}buildCurrentRoundActions(e){return e.currentRoundActions&&0!==e.currentRoundActions.length?e.currentRoundActions.filter(t=>t.phase===e.phase).map(e=>`${e.playerName} ${e.action} ${e.amount||""}`).join(", "):"\u672c\u8f6e\u6682\u65e0\u884c\u52a8"}buildOpponentBehaviorSummary(e){const t=[];return e.forEach(e=>{const n=e.recentActions.slice(-3);n.length>0&&t.push(`${e.playerName}: ${n.map(e=>e.action).join(",")}`)}),t.join("; ")}analyzeBoardTexture(e){if(0===e.length)return"preflop";const t=e.map(e=>e.suit),n=e.map(e=>e.rank),o=t.some(e=>t.filter(t=>t===e).length>=2),i=this.hasStraightDraw(n);return o&&i?"wet":o||i?"semi-wet":"dry"}isDrawHeavyBoard(e){return"wet"===this.analyzeBoardTexture(e)}hasStraightDraw(e){const t=e.map(e=>this.getCardRankValue(e)).sort((e,t)=>e-t);for(let n=0;n<t.length-1;n++)if(t[n+1]-t[n]===1)return!0;return!1}calculateHandStrength(e){const t=e.split(" ");if(2!==t.length)return.5;const[n,o]=t,i=this.getCardRankValue(n[0]),a=this.getCardRankValue(o[0]),r=n[1]===o[1];let s=Math.max(i,a)/14;return i===a&&(s+=.3),r&&(s+=.1),Math.min(s,1)}getCardRankValue(e){return{2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,T:10,J:11,Q:12,K:13,A:14}[e]||0}isNutsHand(e,t){return this.calculateHandStrength(e)>.9}isTrashHand(e){return this.calculateHandStrength(e)<.2}getPositionGroup(e){return["UTG","UTG+1","UTG+2"].includes(e)?"early":["MP","MP+1"].includes(e)?"middle":"late"}getActionType(e){return e.includes("raise")||e.includes("bet")?"aggressive":e.includes("call")?"passive":"unopened"}getPotOddsGroup(e){const t=parseFloat(e.split(":")[0]);return t>3?"good":t>2?"fair":"poor"}}class s{generateDecisionPrompt(e){return"preflop"===e.phase?this.generatePreflopPrompt(e):this.generatePostflopPrompt(e)}generatePreflopPrompt(e){return`\u4f60\u662fPokerGPT-Pro\uff0c\u4e16\u754c\u9876\u7ea7\u5fb7\u5dde\u6251\u514bAI\u3002\u5f53\u524d9\u4eba\u684c\uff0c\u76f2\u6ce850/100\u3002\n\n**\u5f53\u524d\u5c40\u9762** (\u7ffb\u724c\u524d):\n\u4f4d\u7f6e: ${e.position} (${e.positionIndex}/9)\n\u624b\u724c: ${e.holeCards}\n\u7b79\u7801: ${e.myChips} (${(e.myChips/100).toFixed(1)}BB)\n\u5e95\u6c60: ${e.pot}\n\u5f53\u524d\u4e0b\u6ce8: ${e.currentBet}\n\u9700\u8981\u8ddf\u6ce8: ${e.toCall}\n\n**\u884c\u52a8\u5e8f\u5217**: ${e.actionSequence}\n**\u6d3b\u8dc3\u73a9\u5bb6**: ${e.activePlayers}/${e.totalPlayers}\n\n**\u5bf9\u624b\u6863\u6848**:\n${e.opponentProfiles.map(e=>`${e.name}(${e.position}): VPIP${e.vpip}% PFR${e.pfr}% \u6fc0\u8fdb\u5ea6${e.aggression}/10 ${e.tendency}`).join("\n")}\n\n**\u5feb\u901f\u5206\u6790\u8981\u6c42**:\n1. \u624b\u724c\u5f3a\u5ea6\u8bc4\u7ea7(1-10)\n2. \u4f4d\u7f6e\u4f18\u52bf\u8bc4\u4f30\n3. \u5bf9\u624b\u884c\u4e3a\u8bfb\u53d6\n4. \u5e95\u6c60\u8d54\u7387\u8ba1\u7b97\n5. GTO\u57fa\u7840\u7b56\u7565+\u5bf9\u624b\u8c03\u6574\n\n**\u65f6\u95f4\u9650\u5236**: ${e.timeLimit}ms\u5185\u51b3\u7b56\n\n\u8fd4\u56de\u683c\u5f0f:\n{\n  "action": "fold/call/raise",\n  "amount": \u6570\u5b57,\n  "confidence": 0.8,\n  "reasoning": "\u7b80\u6d01\u63a8\u7406(20\u5b57\u5185)",\n  "hand_strength": 7,\n  "position_factor": "early/middle/late",\n  "opponent_adjustment": "tighter/standard/looser"\n}`}generatePostflopPrompt(e){return`PokerGPT-Pro\u7ffb\u724c\u540e\u5206\u6790 - 9\u4eba\u684c\u76f2\u6ce850/100\n\n**\u724c\u9762\u4fe1\u606f**:\n\u624b\u724c: ${e.holeCards}\n\u516c\u5171\u724c: ${e.board}\n\u724c\u9762\u7eb9\u7406: ${e.boardTexture} (${e.drawHeavy?"\u542c\u724c\u591a":"\u542c\u724c\u5c11"})\n\n**\u5f53\u524d\u72b6\u51b5**:\n\u4f4d\u7f6e: ${e.position} (${e.positionIndex}/9)\n\u5e95\u6c60: ${e.pot} (${(e.pot/100).toFixed(1)}BB)\n\u7b79\u7801: ${e.myChips} (${(e.myChips/100).toFixed(1)}BB)\n\u5f53\u524d\u4e0b\u6ce8: ${e.currentBet}\n\u9700\u8981\u8ddf\u6ce8: ${e.toCall}\n\u5e95\u6c60\u8d54\u7387: ${e.potOdds}\n\n**\u672c\u8f6e\u884c\u52a8**: ${e.currentRoundActions}\n**\u5bf9\u624b\u884c\u4e3a\u6a21\u5f0f**: ${e.recentOpponentBehavior}\n\n**\u5feb\u901f\u8bc4\u4f30**:\n1. \u724c\u529b\u7b49\u7ea7(nuts/strong/medium/weak/air)\n2. \u542c\u724c\u53ef\u80fd\u6027\n3. \u5bf9\u624b\u53ef\u80fd\u8303\u56f4\n4. \u4ef7\u503c\u4e0b\u6ce8vs\u8bc8\u552c\u5e73\u8861\n5. \u5bf9\u624b\u503e\u5411\u8c03\u6574\n\n**\u65f6\u95f4\u9650\u5236**: ${e.timeLimit}ms\u5185\u51b3\u7b56\n\n\u8fd4\u56de:\n{\n  "action": "fold/check/call/bet/raise",\n  "amount": \u6570\u5b57,\n  "confidence": 0.85,\n  "reasoning": "\u7b80\u6d01\u63a8\u7406",\n  "hand_category": "strong",\n  "opponent_likely_range": "medium-strong",\n  "play_type": "value/bluff/protection"\n}`}}class c{constructor(){this.playerMetrics=new Map}recordDecision(e,t,n){let o=this.playerMetrics.get(e);o||(o={totalDecisions:0,totalTime:0,averageTime:0,averageConfidence:0,fastDecisions:0,slowDecisions:0},this.playerMetrics.set(e,o)),o.totalDecisions++,o.totalTime+=t,o.averageTime=o.totalTime/o.totalDecisions,o.averageConfidence=(o.averageConfidence*(o.totalDecisions-1)+n)/o.totalDecisions,t<1e3&&o.fastDecisions++,t>1e4&&o.slowDecisions++,console.log(`\ud83d\udcca \u6027\u80fd\u8bb0\u5f55: ${e} - ${t}ms, \u4fe1\u5fc3\u5ea6: ${n.toFixed(2)}`)}getPlayerMetrics(e){return this.playerMetrics.get(e)}getAllMetrics(){return new Map(this.playerMetrics)}}}}]);
//# sourceMappingURL=113.196cb12f.chunk.js.map