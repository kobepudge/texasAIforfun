"use strict";(self.webpackChunkpoker_ai_demo=self.webpackChunkpoker_ai_demo||[]).push([[289],{289:(e,t,n)=>{n.d(t,{gtoService:()=>i});class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://localhost:3001";this.baseUrl=void 0,this.cache=void 0,this.baseUrl=e,this.cache=new Map}generateCacheKey(e){const{hand:t,position:n,facing_action:o="none",players_behind:i=0,stack_bb:r=100}=e;return`${t}_${n}_${o}_${i}_${r}`}async getPreflopDecision(e){const t=this.generateCacheKey(e);if(this.cache.has(t))return console.log(`\u26a1 GTO\u7f13\u5b58\u547d\u4e2d: ${t}`),this.cache.get(t);let n=null;for(let i=1;i<=2;i++)try{console.log(`\ud83d\udd0d GTO\u67e5\u8be2 (\u5c1d\u8bd5 ${i}/2): ${JSON.stringify(e)}`);const n=new URLSearchParams({hand:e.hand,position:e.position,facing_action:e.facing_action||"none",players_behind:(e.players_behind||0).toString(),stack_bb:(e.stack_bb||100).toString()}),o=await fetch(`${this.baseUrl}/api/preflop-decision?${n}`,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(!o.ok)throw new Error(`GTO API\u9519\u8bef: ${o.status} ${o.statusText}`);const r=await o.json();if(!r.success)throw new Error(r.error||"GTO\u51b3\u7b56\u5931\u8d25");return this.cache.set(t,r.decision),console.log(`\u2705 GTO\u51b3\u7b56: ${r.decision.action} ${r.decision.amount||""} (${r.decision.reasoning})`),r.decision}catch(o){n=o,console.warn(`\u26a0\ufe0f GTO\u670d\u52a1\u5c1d\u8bd5 ${i} \u5931\u8d25:`,o),i<2&&await new Promise(e=>setTimeout(e,1e3))}console.error("\u274c GTO\u670d\u52a1\u6240\u6709\u91cd\u8bd5\u90fd\u5931\u8d25:",n);return{action:"fold",amount:0,frequency:1,hand_tier:"UNKNOWN",stack_tier:"medium",stack_bb:e.stack_bb||100,scenario:"fallback",reasoning:"GTO\u670d\u52a1\u4e0d\u53ef\u7528\uff0c\u4fdd\u5b88\u5f03\u724c"}}isPreflop(e){return"preflop"===e}formatHoleCards(e){if(!e||2!==e.length)return"XX";const[t,n]=e,o="10"===t.rank?"T":t.rank,i="10"===n.rank?"T":n.rank,r=t.suit===n.suit,a=["A","K","Q","J","T","9","8","7","6","5","4","3","2"],s=a.indexOf(o),c=a.indexOf(i);let l;return l=o===i?`${o}${i}`:s<c?`${o}${i}${r?"s":"o"}`:`${i}${o}${r?"s":"o"}`,l}formatPosition(e,t,n){const o=(e-n+t)%t,i=["BTN","SB","BB","UTG","UTG+1","UTG+2","MP","MP+1","CO"];if(t<=6){return["BTN","SB","BB","UTG","MP","CO"][o]||"UTG"}return console.log(`\ud83d\udd0d GTO\u4f4d\u7f6e\u683c\u5f0f\u5316: playerIndex=${e}, dealerIndex=${n}, relativePosition=${o}, \u4f4d\u7f6e=${i[o]}`),i[o]||"UTG"}calculateStackDepth(e,t){return Math.round(e/t)}analyzeFacingAction(e,t){if(console.log("\ud83d\udd0d \u5206\u6790\u884c\u52a8\u5386\u53f2:",{actionHistory:e.actionHistory,phase:e.phase,currentBet:e.currentBet,bigBlind:e.bigBlindAmount,currentPlayerId:t}),"preflop"===e.phase)return this.analyzePreflopAction(e,t);if(!e.actionHistory||0===e.actionHistory.length)return"none";const n=e.actionHistory.filter(t=>t.phase===e.phase);if(0===n.length)return"none";const o=n.filter(e=>"fold"!==e.action);if(0===o.length)return"none";const i=o[o.length-1];if("raise"===i.action){const t=i.amount/(e.bigBlindAmount||100);return t<=2.5?"raise_2bb":t<=3.5?"raise_3bb":t<=4.5?"raise_4bb":"3bet"}return"call"===i.action?"limp":"none"}analyzePreflopAction(e,t){var n;const o=e.bigBlindAmount||100,i=e.currentBet||0;console.log("\ud83d\udd0d \u7ffb\u524d\u884c\u52a8\u5206\u6790:",{currentBet:i,bigBlind:o,ratio:i/o,actionHistory:e.actionHistory,currentPlayerId:t});const r=((null===(n=e.actionHistory)||void 0===n?void 0:n.filter(e=>"preflop"===e.phase))||[]).filter(e=>"fold"!==e.action);if(console.log("\ud83d\udd0d \u6709\u6548\u7ffb\u524d\u884c\u52a8:",r),i<=o&&0===r.length)return"none";if(i===o){if(r.filter(e=>"call"===e.action).length>0){var a;const n=null===(a=e.players)||void 0===a?void 0:a.find(e=>e.id===t);if(n){if("BB"===this.formatPosition(n.position,e.players.length,e.dealerIndex))return console.log("\ud83c\udfaf BB\u4f4d\u7f6e\u9762\u5bf9\u8ddb\u5165\uff0c\u53ef\u4ee5\u514d\u8d39\u770b\u7ffb\u724c\uff0cfacing_action=none"),"none"}return"limp"}return"none"}const s=r.filter(e=>"raise"===e.action);if(0===s.length)return"none";const c=i/o;return s.length>=2?s.length>=3?"4bet":"3bet":c<=2.5?"raise_2bb":c<=3.5?"raise_3bb":"raise_4bb"}calculatePlayersBehind(e,t){if(!e.players||!e.actionHistory)return 0;const n=e.players.findIndex(e=>e.id===t);if(-1===n)return 0;const o=e.actionHistory.filter(e=>"preflop"===e.phase),i=new Set(o.map(e=>e.playerId));let r=0;const a=e.players.length;for(let s=1;s<a;s++){const t=(n+s)%a,o=e.players[t];o.isActive&&!i.has(o.id)&&r++}return console.log(`\ud83d\udd0d \u8ba1\u7b97\u540e\u9762\u73a9\u5bb6: \u5f53\u524d\u73a9\u5bb6${t}, \u540e\u9762\u8fd8\u6709${r}\u4e2a\u73a9\u5bb6\u672a\u884c\u52a8`),r}async healthCheck(){try{return(await fetch(`${this.baseUrl}/api/health`,{signal:AbortSignal.timeout(3e3)})).ok}catch{return!1}}clearCache(){this.cache.clear(),console.log("\ud83d\uddd1\ufe0f GTO\u7f13\u5b58\u5df2\u6e05\u7a7a")}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}const i=new o}}]);
//# sourceMappingURL=289.5caf4dc9.chunk.js.map