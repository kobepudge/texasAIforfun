"use strict";(self.webpackChunkpoker_ai_demo=self.webpackChunkpoker_ai_demo||[]).push([[397],{397:(e,t,s)=>{s.d(t,{AIInstanceManager:()=>r});let i=function(e){return e.GAME_INITIALIZED="game_initialized",e.GAME_STARTED="game_started",e.GAME_ENDED="game_ended",e.ROUND_STARTED="round_started",e.ROUND_ENDED="round_ended",e.PLAYER_JOINED="player_joined",e.PLAYER_LEFT="player_left",e.PLAYER_ACTION="player_action",e.PLAYER_TURN_START="player_turn_start",e.PLAYER_TURN_END="player_turn_end",e.PLAYER_ELIMINATED="player_eliminated",e.CARDS_DEALT="cards_dealt",e.COMMUNITY_CARDS_REVEALED="community_cards_revealed",e.BLINDS_POSTED="blinds_posted",e.POT_UPDATED="pot_updated",e.PHASE_CHANGED="phase_changed",e.AI_DECISION_START="ai_decision_start",e.AI_DECISION_COMPLETE="ai_decision_complete",e.AI_DECISION_TIMEOUT="ai_decision_timeout",e.AI_ANALYSIS_UPDATE="ai_analysis_update",e.PERFORMANCE_METRIC="performance_metric",e.ERROR_OCCURRED="error_occurred",e.WARNING_ISSUED="warning_issued",e}({}),n=function(e){return e[e.CRITICAL=0]="CRITICAL",e[e.HIGH=1]="HIGH",e[e.MEDIUM=2]="MEDIUM",e[e.LOW=3]="LOW",e[e.DEBUG=4]="DEBUG",e}({});const a=new class{constructor(){this.handlers=new Map,this.eventHistory=[],this.eventQueue=[],this.isProcessing=!1,this.stats=void 0,this.maxHistorySize=1e3,this.stats={totalEvents:0,eventsByType:new Map,eventsByPriority:new Map,averageProcessingTime:0,errorCount:0},this.startEventProcessing()}subscribe(e,t){return this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),console.log(`\ud83d\udcdd \u8ba2\u9605\u4e8b\u4ef6: ${e}`),()=>{const s=this.handlers.get(e);if(s){const e=s.indexOf(t);e>-1&&s.splice(e,1)}}}emit(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.MEDIUM;const a={id:this.generateEventId(),type:e,playerId:s,data:t,timestamp:Date.now(),priority:i};this.eventQueue.push(a),this.eventQueue.sort((e,t)=>e.priority-t.priority),console.log(`\ud83d\ude80 \u4e8b\u4ef6\u5165\u961f: ${e} (\u4f18\u5148\u7ea7: ${i})`)}emitImmediate(e,t,s){const i={id:this.generateEventId(),type:e,playerId:s,data:t,timestamp:Date.now(),priority:n.CRITICAL};this.processEvent(i)}startEventProcessing(){setInterval(()=>{!this.isProcessing&&this.eventQueue.length>0&&this.processNextEvent()},10)}async processNextEvent(){if(0===this.eventQueue.length)return;this.isProcessing=!0;const e=this.eventQueue.shift();await this.processEvent(e),this.isProcessing=!1}async processEvent(e){const t=Date.now();try{this.addToHistory(e);const s=(this.handlers.get(e.type)||[]).map(async t=>{try{await t(e)}catch(s){console.error(`\u274c \u4e8b\u4ef6\u5904\u7406\u5668\u9519\u8bef ${e.type}:`,s),this.stats.errorCount++}});await Promise.all(s),this.updateStats(e,Date.now()-t)}catch(s){console.error(`\u274c \u4e8b\u4ef6\u5904\u7406\u5931\u8d25 ${e.type}:`,s),this.stats.errorCount++}}addToHistory(e){this.eventHistory.push(e),this.eventHistory.length>this.maxHistorySize&&this.eventHistory.shift()}updateStats(e,t){this.stats.totalEvents++;const s=this.stats.eventsByType.get(e.type)||0;this.stats.eventsByType.set(e.type,s+1);const i=this.stats.eventsByPriority.get(e.priority)||0;this.stats.eventsByPriority.set(e.priority,i+1),this.stats.averageProcessingTime=(this.stats.averageProcessingTime*(this.stats.totalEvents-1)+t)/this.stats.totalEvents}getEventHistory(e){let t=[...this.eventHistory];return e&&(e.types&&(t=t.filter(t=>e.types.includes(t.type))),e.playerId&&(t=t.filter(t=>t.playerId===e.playerId)),void 0!==e.priority&&(t=t.filter(t=>t.priority===e.priority)),e.timeRange&&(t=t.filter(t=>t.timestamp>=e.timeRange.start&&t.timestamp<=e.timeRange.end))),t}getStats(){return{...this.stats}}clearHistory(){this.eventHistory=[],console.log("\ud83e\uddf9 \u4e8b\u4ef6\u5386\u53f2\u5df2\u6e05\u7406")}generateEventId(){return`event_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getPerformanceReport(){const e=this.getStats();return`\n\ud83d\udcc8 \u4e8b\u4ef6\u603b\u7ebf\u6027\u80fd\u62a5\u544a\n==================\n\u603b\u4e8b\u4ef6\u6570: ${e.totalEvents}\n\u5e73\u5747\u5904\u7406\u65f6\u95f4: ${e.averageProcessingTime.toFixed(2)}ms\n\u9519\u8bef\u6570\u91cf: ${e.errorCount}\n\u961f\u5217\u957f\u5ea6: ${this.eventQueue.length}\n\n\u4e8b\u4ef6\u7c7b\u578b\u5206\u5e03:\n${Array.from(e.eventsByType.entries()).map(e=>{let[t,s]=e;return`  ${t}: ${s}`}).join("\n")}\n\n\u4f18\u5148\u7ea7\u5206\u5e03:\n${Array.from(e.eventsByPriority.entries()).map(e=>{let[t,s]=e;return`  ${n[t]}: ${s}`}).join("\n")}\n`}};class o{constructor(e){this.config=void 0,this.gameState=null,this.holeCards=[],this.opponentProfiles=new Map,this.decisionHistory=[],this.isActive=!1,this.currentDecisionPromise=null,this.config=e,this.setupEventListeners(),console.log(`\ud83e\udd16 AI\u73a9\u5bb6\u521b\u5efa: ${e.name}`),console.log("\ud83c\udfad \u6027\u683c\u7279\u5f81:",e.personality)}setupEventListeners(){a.subscribe(i.GAME_STARTED,e=>{this.onGameStarted(e.data)}),a.subscribe(i.CARDS_DEALT,e=>{e.playerId===this.config.id&&this.onCardsDealt(e.data.cards)}),a.subscribe(i.PLAYER_TURN_START,e=>{e.playerId===this.config.id&&this.onMyTurn(e.data)}),a.subscribe(i.PLAYER_ACTION,e=>{e.playerId!==this.config.id&&this.onOpponentAction(e.data)})}onGameStarted(e){this.isActive=!0,this.gameState=e.gameState,this.initializeOpponentProfiles(),console.log(`\ud83d\ude80 ${this.config.name} \u52a0\u5165\u6e38\u620f`)}onCardsDealt(e){this.holeCards=e,console.log(`\ud83c\udccf ${this.config.name} \u6536\u5230\u624b\u724c: ${this.formatCards(e)}`),this.analyzeHoleCards()}async onMyTurn(e){if(this.isActive&&this.gameState){console.log(`\ud83c\udfaf \u8f6e\u5230 ${this.config.name} \u884c\u52a8`),a.emit(i.AI_DECISION_START,{playerId:this.config.id,playerName:this.config.name,gameState:this.gameState},this.config.id);try{const e=await this.makeDecision();a.emit(i.AI_DECISION_COMPLETE,{playerId:this.config.id,playerName:this.config.name,decision:e},this.config.id),this.executeDecision(e)}catch(t){console.error(`\u274c ${this.config.name} \u51b3\u7b56\u5931\u8d25:`,t),a.emit(i.AI_DECISION_TIMEOUT,{playerId:this.config.id,playerName:this.config.name,error:t.message},this.config.id),this.executeDecision({action:"fold",amount:0,confidence:0,reasoning:"\u51b3\u7b56\u8d85\u65f6\uff0c\u81ea\u52a8\u5f03\u724c",decisionTime:this.config.decisionTimeoutMs,metadata:{handStrength:0,positionFactor:"unknown",opponentAdjustment:"none",playType:"fold"}})}}}onOpponentAction(e){this.updateOpponentProfile(e)}analyzeHoleCards(){if(2!==this.holeCards.length)return;const e=this.calculateHandStrength(this.holeCards),t=this.calculatePlayability(this.holeCards);console.log(`\ud83e\udde0 ${this.config.name} \u624b\u724c\u5206\u6790:`),console.log(`   \u5f3a\u5ea6: ${e.toFixed(2)}`),console.log(`   \u53ef\u73a9\u6027: ${t.toFixed(2)}`)}async makeDecision(){const e=Date.now(),t=new Promise((e,t)=>{setTimeout(()=>{t(new Error("\u51b3\u7b56\u8d85\u65f6"))},this.config.decisionTimeoutMs)}),s=this.performDecisionAnalysis();this.currentDecisionPromise=Promise.race([s,t]);const i=await this.currentDecisionPromise;return i.decisionTime=Date.now()-e,this.decisionHistory.push(i),i}async performDecisionAnalysis(){const e=this.calculateHandStrength(this.holeCards),t=this.getMyPosition(),s=this.calculatePotOdds();console.log(`\ud83d\udd0d ${this.config.name} \u51b3\u7b56\u5206\u6790:`),console.log(`   \u624b\u724c\u5f3a\u5ea6: ${e.toFixed(2)}`),console.log(`   \u4f4d\u7f6e: ${t}`),console.log(`   \u5e95\u6c60\u8d54\u7387: ${s.toFixed(2)}`);let i="fold",n=0,a=.5,o="\u57fa\u7840\u51b3\u7b56\u903b\u8f91";return e>.8?(i="raise",n=3*this.gameState.bigBlind,a=.9,o="\u5f3a\u724c\u52a0\u6ce8"):e>.6?(i="call",a=.7,o="\u4e2d\u7b49\u724c\u529b\u8ddf\u6ce8"):e>.4&&s>2?(i="call",a=.6,o="\u5e95\u6c60\u8d54\u7387\u5408\u9002"):(i="fold",a=.8,o="\u724c\u529b\u4e0d\u8db3\u5f03\u724c"),{action:i,amount:n,confidence:a,reasoning:o,decisionTime:0,metadata:{handStrength:e,positionFactor:t,opponentAdjustment:"standard",playType:"raise"===i?"value":"call"===i?"call":"fold"}}}executeDecision(e){console.log(`\u26a1 ${this.config.name} \u6267\u884c\u51b3\u7b56: ${e.action} ${e.amount||""}`),console.log(`   \u63a8\u7406: ${e.reasoning}`),console.log(`   \u4fe1\u5fc3: ${(100*e.confidence).toFixed(1)}%`),console.log(`   \u8017\u65f6: ${e.decisionTime}ms`),a.emit(i.PLAYER_ACTION,{playerId:this.config.id,playerName:this.config.name,action:e.action,amount:e.amount,reasoning:e.reasoning,confidence:e.confidence},this.config.id)}initializeOpponentProfiles(){this.gameState&&(this.gameState.players.forEach(e=>{e.id!==this.config.id&&this.opponentProfiles.set(e.id,{playerId:e.id,playerName:e.name,vpip:25,pfr:18,aggression:1.5,tightness:.5,bluffFrequency:.2,positionAwareness:.5,recentActions:[],lastUpdate:Date.now(),tendency:"TAG"})}),console.log(`\ud83c\udfd7\ufe0f ${this.config.name} \u521d\u59cb\u5316\u4e86 ${this.opponentProfiles.size} \u4e2a\u5bf9\u624b\u6863\u6848`))}updateOpponentProfile(e){var t;const s=this.opponentProfiles.get(e.playerId);s&&(s.recentActions.push({action:e.action,amount:e.amount,position:e.position||"unknown",phase:(null===(t=this.gameState)||void 0===t?void 0:t.phase)||"unknown",outcome:"pending",timestamp:Date.now()}),s.recentActions.length>20&&s.recentActions.shift(),s.lastUpdate=Date.now(),console.log(`\ud83d\udcca ${this.config.name} \u66f4\u65b0\u5bf9\u624b\u6863\u6848: ${s.playerName}`))}calculateHandStrength(e){if(2!==e.length)return 0;const[t,s]=e,i=this.getCardRankValue(t.rank),n=this.getCardRankValue(s.rank);let a=Math.max(i,n);i===n&&(a+=i),t.suit===s.suit&&(a+=2);const o=Math.abs(i-n);return o<=4&&(a+=5-o),Math.min(a/20,1)}calculatePlayability(e){return this.calculateHandStrength(e)*(.8+.4*this.config.personality.aggression)}getMyPosition(){if(!this.gameState)return"unknown";const e=this.gameState.players.findIndex(e=>e.id===this.config.id),t=this.gameState.dealerIndex,s=this.gameState.players.length,i=(e-t+s)%s;return["BTN","SB","BB","UTG","UTG+1","UTG+2","MP","MP+1","CO"][i]||`POS${i}`}calculatePotOdds(){if(!this.gameState)return 0;const e=this.gameState.currentBet;return this.gameState.pot/(e||1)}formatCards(e){return e.map(e=>`${e.rank}${e.suit}`).join(" ")}getCardRankValue(e){return{2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,T:10,J:11,Q:12,K:13,A:14}[e]||0}getId(){return this.config.id}getName(){return this.config.name}getOpponentProfiles(){return new Map(this.opponentProfiles)}getDecisionHistory(){return[...this.decisionHistory]}isCurrentlyActive(){return this.isActive}}class r{constructor(e){this.aiPlayers=new Map,this.performanceMetrics=new Map,this.healthStatus=new Map,this.config=void 0,this.monitoringInterval=null,this.config=e,this.setupEventListeners(),e.enablePerformanceMonitoring&&this.startPerformanceMonitoring(),console.log("\ud83e\udd16 AI\u5b9e\u4f8b\u7ba1\u7406\u5668\u521d\u59cb\u5316\u5b8c\u6210"),console.log("\ud83d\udcca \u914d\u7f6e:",e)}setupEventListeners(){a.subscribe(i.AI_DECISION_START,e=>{this.onAIDecisionStart(e)}),a.subscribe(i.AI_DECISION_COMPLETE,e=>{this.onAIDecisionComplete(e)}),a.subscribe(i.AI_DECISION_TIMEOUT,e=>{this.onAIDecisionTimeout(e)}),a.subscribe(i.ERROR_OCCURRED,e=>{e.playerId&&this.aiPlayers.has(e.playerId)&&this.onAIError(e)})}createAIPlayer(e,t){if(this.aiPlayers.size>=this.config.maxAIPlayers)throw new Error(`AI\u73a9\u5bb6\u6570\u91cf\u5df2\u8fbe\u4e0a\u9650: ${this.config.maxAIPlayers}`);const s=`ai_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,i={id:s,name:e,personality:{aggression:.5,tightness:.5,bluffFrequency:.2,adaptability:.7,riskTolerance:.5,...t},apiConfig:{...this.config.apiConfig,temperature:.1,maxTokens:150},decisionTimeoutMs:this.config.defaultTimeout},n=new o(i);return this.aiPlayers.set(s,n),this.performanceMetrics.set(s,{playerId:s,playerName:e,averageDecisionTime:0,successRate:1,timeoutCount:0,totalDecisions:0,lastDecisionTime:0,isHealthy:!0}),this.healthStatus.set(s,{playerId:s,status:"healthy",lastHeartbeat:Date.now(),consecutiveFailures:0,issues:[]}),console.log(`\ud83d\ude80 \u521b\u5efaAI\u73a9\u5bb6: ${e} (${s})`),console.log("\ud83c\udfad \u6027\u683c\u7279\u5f81:",i.personality),n}removeAIPlayer(e){const t=this.aiPlayers.get(e);return t?(this.aiPlayers.delete(e),this.performanceMetrics.delete(e),this.healthStatus.delete(e),console.log(`\ud83d\uddd1\ufe0f \u79fb\u9664AI\u73a9\u5bb6: ${t.getName()} (${e})`),!0):(console.warn(`\u26a0\ufe0f AI\u73a9\u5bb6\u4e0d\u5b58\u5728: ${e}`),!1)}getAIPlayer(e){return this.aiPlayers.get(e)}getAllAIPlayers(){return Array.from(this.aiPlayers.values())}getPerformanceMetrics(e){if(e){const t=this.performanceMetrics.get(e);return t?[t]:[]}return Array.from(this.performanceMetrics.values())}getHealthStatus(e){if(e){const t=this.healthStatus.get(e);return t?[t]:[]}return Array.from(this.healthStatus.values())}startPerformanceMonitoring(){this.monitoringInterval=setInterval(()=>{this.performHealthCheck(),this.updatePerformanceMetrics()},5e3),console.log("\ud83d\udcca AI\u6027\u80fd\u76d1\u63a7\u5df2\u542f\u52a8")}stopPerformanceMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null,console.log("\ud83d\uded1 AI\u6027\u80fd\u76d1\u63a7\u5df2\u505c\u6b62"))}performHealthCheck(){const e=Date.now();this.healthStatus.forEach((t,s)=>{const n=e-t.lastHeartbeat,o=this.performanceMetrics.get(s);n>6e4?(t.status="offline",t.issues.push("\u957f\u65f6\u95f4\u65e0\u54cd\u5e94")):t.consecutiveFailures>=3?(t.status="critical",t.issues.push("\u8fde\u7eed\u51b3\u7b56\u5931\u8d25")):o&&o.averageDecisionTime>.8*this.config.defaultTimeout?(t.status="warning",t.issues.push("\u51b3\u7b56\u65f6\u95f4\u8fc7\u957f")):(t.status="healthy",t.issues=[]),"healthy"!==t.status&&a.emit(i.WARNING_ISSUED,{playerId:s,healthStatus:t,message:`AI\u73a9\u5bb6\u5065\u5eb7\u72b6\u6001: ${t.status}`},s)})}updatePerformanceMetrics(){this.performanceMetrics.forEach(e=>{e.isHealthy=e.successRate>.8&&e.averageDecisionTime<.8*this.config.defaultTimeout})}onAIDecisionStart(e){const t=e.playerId,s=this.healthStatus.get(t);s&&(s.lastHeartbeat=Date.now())}onAIDecisionComplete(e){const t=e.playerId,s=e.data.decision;this.updateMetricsOnSuccess(t,s.decisionTime)}onAIDecisionTimeout(e){const t=e.playerId;this.updateMetricsOnTimeout(t)}onAIError(e){const t=e.playerId;this.updateMetricsOnError(t,e.data.error)}updateMetricsOnSuccess(e,t){const s=this.performanceMetrics.get(e),i=this.healthStatus.get(e);if(s){s.totalDecisions++,s.lastDecisionTime=t,s.averageDecisionTime=(s.averageDecisionTime*(s.totalDecisions-1)+t)/s.totalDecisions;const e=s.totalDecisions-s.timeoutCount;s.successRate=e/s.totalDecisions}i&&(i.consecutiveFailures=0,i.lastHeartbeat=Date.now())}updateMetricsOnTimeout(e){const t=this.performanceMetrics.get(e),s=this.healthStatus.get(e);if(t){t.totalDecisions++,t.timeoutCount++,t.lastDecisionTime=this.config.defaultTimeout;const e=t.totalDecisions-t.timeoutCount;t.successRate=e/t.totalDecisions}s&&(s.consecutiveFailures++,s.lastHeartbeat=Date.now())}updateMetricsOnError(e,t){const s=this.healthStatus.get(e);s&&(s.consecutiveFailures++,s.issues.push(t),s.lastHeartbeat=Date.now(),s.issues.length>5&&s.issues.shift())}generatePerformanceReport(){const e=this.getPerformanceMetrics(),t=this.getHealthStatus(),s=e.length,i=t.filter(e=>"healthy"===e.status).length,n=e.reduce((e,t)=>e+t.averageDecisionTime,0)/s,a=e.reduce((e,t)=>e+t.successRate,0)/s;return`\n\ud83d\udcc8 AI\u5b9e\u4f8b\u7ba1\u7406\u5668\u6027\u80fd\u62a5\u544a\n========================\n\u603bAI\u6570\u91cf: ${s}\n\u5065\u5eb7AI\u6570\u91cf: ${i}\n\u5e73\u5747\u51b3\u7b56\u65f6\u95f4: ${n.toFixed(2)}ms\n\u5e73\u5747\u6210\u529f\u7387: ${(100*a).toFixed(1)}%\n\n\u4e2a\u4f53\u6027\u80fd:\n${e.map(e=>`${e.playerName}: ${e.averageDecisionTime.toFixed(0)}ms, ${(100*e.successRate).toFixed(1)}% \u6210\u529f\u7387`).join("\n")}\n\n\u5065\u5eb7\u72b6\u6001:\n${t.map(e=>`${e.playerId}: ${e.status}${e.issues.length>0?` (${e.issues.join(", ")})`:""}`).join("\n")}\n`}cleanup(){this.stopPerformanceMonitoring(),this.aiPlayers.clear(),this.performanceMetrics.clear(),this.healthStatus.clear(),console.log("\ud83e\uddf9 AI\u5b9e\u4f8b\u7ba1\u7406\u5668\u8d44\u6e90\u5df2\u6e05\u7406")}}}}]);
//# sourceMappingURL=397.63036725.chunk.js.map